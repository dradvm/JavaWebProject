</html>
<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{Layout/layout}">

    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/b42e1089e2.js" crossorigin="anonymous"></script>
        <script src="../../static/js/jquery.min.js"></script>
        <script src="../../static/js/angular.min.js"></script>
        <link rel="stylesheet" href="../../static/css/mycss.css">
    </head>

    <body>
        <div layout:fragment="contentMainPage">
<!--            <div ng-app="detailsCaterer">
                <div class="container mt-5" ng-controller="detailsCaterer">
                    <div class="row h-25">
                        <div class="col-4 h-100 ">
                            <div class="position-relative overflow-hidden rounded border h-100">
                                <img th:src="${profileImg}" class="w-100" alt="" style="filter: blur(4px);">
                                <div class="overflow-hidden position-absolute top-0 left-0 w-100 bg-black opacity-25"
                                     style="height: 100%;">

                                </div>
                                <div class="position-absolute mx-3 my-4 top-0 left-0 w-100">
                                    <div class="v-stack">
                                        <div class="d-flex align-items-center">
                                            <div class=" rounded-circle overflow-hidden"
                                                 style="width: 60px; height: 60px; border: 3px solid #ccc;">
                                                <img th:src="${caterer.profileImage}" class="w-100 h-100" alt="">
                                            </div>
                                            <div class="v-stack ms-3 gap">
                                                <div class="fs-5 text-white" style="text-shadow: 1px 1px black;"
                                                     th:text="${caterer.fullName}">
                                                </div>
                                                <div class="fs-7 text-white" style="text-shadow: 1px 1px black;">
                                                    <i style="width: 26px;" class="fa-solid fa-phone"></i>
                                                    <span class="fs-7" th:text="${caterer.phone}"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="v-stack mt-3">
                                            <div class="fs-7 text-white" style="text-shadow: 1px 1px black;">
                                                <i style="width: 26px;" class="fa-solid fa-city"></i>
                                                <span class="fs-7" th:text="${caterer.districtID.cityID.cityName}"></span>
                                            </div>
                                            <div class="fs-7 text-white" style="text-shadow: 1px 1px black;">
                                                <i style="width: 26px;" class="fa-solid fa-building-circle-arrow-right"></i>
                                                <span class="fs-7" th:text="${caterer.districtID.districtName}"></span>
                                            </div>
                                            <div class="fs-7 text-white" style="text-shadow: 1px 1px black;">
                                                <i style="width: 26px;" class="fa-solid fa-location-dot"></i>
                                                <span class="fs-7" th:text="${caterer.address}"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="position-absolute " style="top: 3%; right: 3%;">
                                    <div class="favorite-floating-btn favorite-floating-btn-mark">
                                        <i class="fa-solid fa-heart heart"></i>
                                    </div>
                                </button>
                            </div>
                        </div>
                        <div class="col-4 h-100">
                            <div class="d-flex flex-column h-100 ms-3 mt-4">
                                <div class="my-2 d-flex align-items-center">
                                    <i class=" fa-regular fa-id-card" style="width: 26px;"></i>
                                    <span>Rank: </span>
                                    <span class="text-danger ms-2 fw-medium" th:text="${caterer.rankID.rankID}"></span>
                                </div>
                                <div class="my-2 d-flex align-items-center">
                                    <i class=" fa-regular fa-star" style="width: 26px;"></i>
                                    <span>Rate: </span>
                                    <span class="text-danger ms-2 fw-medium" th:text="${caterer.catererRating}"></span>
                                </div>
                                <div class="my-2 d-flex align-items-center">
                                    <i class=" fa-regular fa-heart" style="width: 26px;"></i>
                                    <span>Favorite: </span>
                                    <span class="text-danger ms-2 fw-medium"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-4 h-100">
                            <div class="d-flex flex-column h-100 ms-3 mt-4">
                                <div class="my-2 d-flex align-items-center">
                                    <i class=" fa-solid fa-plate-wheat" style="width: 26px;"></i>
                                    <span>Product: </span>
                                    <span class="text-danger ms-2 fw-medium">240</span>
                                </div>
                                <div class="my-2 d-flex align-items-center">
                                    <i class=" fa-solid fa-user-check" style="width: 26px;"></i>
                                    <span>Join Time: </span>
                                    <span class="text-danger ms-2 fw-medium" th:text="${caterer.createDate}">240</span>
                                </div>
                                <div class="my-2 d-flex align-items-center">
                                    <i class=" fa-solid fa-basket-shopping" style="width: 26px;"></i>
                                    <span>Order: </span>
                                    <span class="text-danger ms-2 fw-medium"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row my-row mt-5  gy-2">
                        <div class="col-3" ng-virtual-scroll ng-repeat="(index, item) in listDish">
                            <div id="dish-{{$index}}" class="overflow-hidden v-stack bg-white border"
                                 style="border-radius: 12px;">
                                <div>
                                    <img ng:src="{{item.image}}" alt="" class="w-100" style="height: 150px;">
                                </div>
                                <div class="px-3 py-3">
                                    <div class="fs-6 fw-medium d-flex align-items-center" style="min-height: 50px;">
                                        {{item.name}}</div>
                                    <div class="fs-6 fw-medium mt-2">${{item.price}}</div>
                                    <div th:unless="${session.get('scopedTarget.authController') != null && session.get('scopedTarget.authController').role == 'Caterer'}"
                                         class="d-flex justify-content-between align-items-center mt-3">
                                        <div class="border rounded overflow-hidden">
                                            <button class="my-btn bg-main text-white fw-bold px-3 py-1" data-action="minus"
                                                    type="button" onclick="updateValue(this, 'minus')">-</button>
                                            <input class="border-0 text-center" style="outline: 0; width: 30px;"
                                                   type="number" name="product-qty" min="0" max="999" value="1" oninput="this.value = 
                                                   this.value >= 0 && this.value <= 999 ? Math.abs(this.value) : null">
                                            <button class="my-btn bg-main text-white fw-bold px-3 py-1" data-action="add"
                                                    type="button" onclick="updateValue(this, 'add')">+</button>
                                        </div>
                                        <button
                                            th:if="${session.get('scopedTarget.authController') != null && session.get('scopedTarget.authController').role == 'Customer'}"
                                            class="fw-medium my-btn p-2 rounded-circle text-white rounded-pill bg-main"
                                            ng-click="addDish(item, index, $event)">
                                            <i class="fa-solid fa-bag-shopping"></i>
                                        </button>
                                        <a th:unless="${session.get('scopedTarget.authController') != null && session.get('scopedTarget.authController').role == 'Customer'}"
                                           href="/auth/toLogin">
                                            <button
                                                class="fw-medium my-btn p-2 rounded-circle text-white rounded-pill bg-main">
                                                <i class="fa-solid fa-bag-shopping"></i>
                                            </button>
                                        </a>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div th:if="${session.get('scopedTarget.authController') != null && session.get('scopedTarget.authController').role == 'Customer'}"
                     class="position-fixed bottom-0 end-0 mb-4 me-4 z-2">

                    <button class="my-btn rounded-circle p-3 bg-main" onclick="toggleModalOrder()">
                        <i class="fa-solid fa-list text-white"></i>
                    </button>
                </div>

                <div th:if="${session.get('scopedTarget.authController') != null && session.get('scopedTarget.authController').role == 'Customer'}"
                     ng-controller="order" class="position-fixed bottom-0 end-0 me-4 z-3 d-none" id="modalOrder"
                     style="margin-bottom: 5rem;">
                    <div class="border bg-white rounded overflow-hidden" style="width: 400px; height: 85vh">
                        <div class="v-stack">
                            <div class="w-100 bg-main d-flex align-items-center justify-content-around" style="height: 8%;">
                                <div class="fs-5 fw-medium py-2 text-white">Your Order</div>
                            </div>
                            <div ng-if="!isEmpty" class="px-3 py-2 overflow-auto" style="height: 57%;">
                                <div class="mb-2 border rounded px-3 py-2" ng-repeat="(index, item) in order"
                                     id="order-{{$index}}">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div style="width: 85%;">
                                            <div class="d-flex align-items-center justify-content-between">
                                                <div class="fw-medium">{{item.name}}</div>
                                                <div class="fw-medium">${{item.price}}</div>
                                            </div>
                                            <div class="mt-2 d-flex align-items-center justify-content-between">
                                                <div class="border rounded overflow-hidden">
                                                    <button class="my-btn bg-main text-white fw-bold px-3 py-1"
                                                            data-action="minus" type="button"
                                                            ng-click="updateValueDishOrder(item, index, $event, 'minus')">-</button>
                                                    <input class="border-0 text-center" style="outline: 0; width: 30px;"
                                                           type="number" name="product-qty" min="0" max="999" readonly
                                                           ng-model="item.quantity">
                                                    <button class="my-btn bg-main text-white fw-bold px-3 py-1"
                                                            data-action="add" type="button"
                                                            ng-click="updateValueDishOrder(item, index, $event, 'add')">+</button>
                                                </div>
                                                <div class="fw-medium fs-5">
                                                    ${{calcTotal(item.price, item.quantity)}}
                                                </div>
                                            </div>
                                        </div>
                                        <div style="width: 10%; cursor: pointer;"
                                             class="bg-danger d-flex align-items-center justify-content-around p-2 rounded"
                                             ng-click="deleteDish(item)">
                                            <i class="fa-solid fa-trash text-white"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div ng-if="!isEmpty" class="bg-main w-100 px-3 py-2 d-flex flex-column justify-content-between"
                                 style="height: 35%;">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center justify-content-between" style="width: 45%;">
                                        <input type="text" class="form-control" placeholder="Enter voucher" id="voucher">

                                    </div>

                                    <div class="d-flex align-items-center justify-content-between" style="width: 50%;">
                                        <input type="number" min="0" class="form-control" placeholder="Enter point"
                                               id="point">
                                    </div>
                                </div>
                                <div class=" d-flex align-items-center justify-content-between">
                                    <div class="fw-medium">Total</div>
                                    <div class="fw-bold">${{totalValue}}</div>
                                </div>
                                <div class="">
                                    <div class="input-group my-input-form">
                                        <textarea type="text" class="form-control" placeholder="Note"
                                                  id="caterer-description" maxlength="200"></textarea>
                                    </div>
                                </div>
                                <button class="my-btn bg-white rounded-pill w-100 py-2 fw-medium" ng-click="postOrder()">
                                    Make order
                                </button>
                            </div>
                            <div ng-if="isEmpty" style="height: 92%;">
                                <div class="w-100 h-100 d-flex flex-column align-items-center justify-content-around">
                                    <img th:src="@{/images/empty-cart.png}" class="w-100" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>-->

            <div>
                <div th:each="dish : ${dishList}">
                    <img th:src="${dish.dishImage}"/>
                    <div th:text="${dish.dishName}"></div>
                    <div th:text="${'$' + dish.dishPrice}"></div>
                    <form onsubmit="addDish(event, this)">
                        <input type="hidden" name="id" th:value="${dish.dishID}">
                        <input type="number" name="quantity" value="0">
                        <button type="submit" ons>Add</button>
                    </form>
                </div>
                <div>
                    <div id="orderDishes"></div>
                    <form>
                        <label for="selectedVoucher">Voucher:</label>
                        <select id="selectedVoucher" onchange="calcTotal()">
                            <option value="0" selected>No voucher</option>
                            <option
                                th:each="voucher : ${voucherList}"
                                th:value="${voucher.voucherID}"
                                th:text="${voucher.voucherID + ' ' + voucher.typeID.typeID + ' ' + voucher.voucherValue}">
                            </option>
                        </select>
                        <label for="usePoint">Use point?</label>
                        <select id="usePoint" onchange="calcTotal()">
                            <option value="0" selected>No</option>
                            <option value="1">Yes</option>
                        </select>
                        <total id="total"></total>
                        <label for="orderTime">
                            Order time (yyyy-MM-dd HH:mm)<span style="color:red;">*</span>:
                        </label>
                        <input id="orderTime" type="datetime">
                        <div id="orderTime-error"></div>
                        <select id="address-type" onchange="changeAddress()">
                            <option value="0" selected>Use new address</option>
                            <option value="1" th:if="${addressList != null}">Use your available delivery address</option>
                        </select>
                        <div id="address-type-0">
                            <label for="address">
                                Delivery address<span style="color:red;">*</span>:
                            </label>
                            <input id="address-0">
                            <div id="address-0-error"></div>
                            <select id="districtID">
                                <option 
                                    th:each="district : ${districtList}" 
                                    th:value="${district.districtID}"
                                    th:text="${district.districtName + ', ' + district.cityID.cityName}">
                                </option>
                            </select>
                        </div>
                        <div id='address-type-1' style="display: none;">
                            <select id='address-1'>
                                <option 
                                    th:each="address : ${addressList}"
                                    th:value="${address.addressID}"
                                    th:text="${address.address + ', ' + address.districtID.districtName + ', ' + address.districtID.cityID.cityName}">
                                </option>
                            </select>
                        </div>
                        <label for="note">Note</label>
                        <textarea id="note"></textarea>
                        <div id="error"></div>
                        <button type="button" onclick="createOrder()">Create order</button>
                    </form>
                </div>
            </div>
<!--            <script>
                const myApp = angular.module("detailsCaterer", [])
                        .factory("CatererService", function ($http, $location) {
                        var x = $location.absUrl().split("/")
                                var n = x.length
                                return {
                                getCatererDish: function () {
                                return $http.get("/getCatererDish/" + x[n - 1])
                                },
                                        getCatererVoucher: function () {
                                        return $http.get("/getCatererVoucher/" + x[n - 1])
                                        },
                                }

                        })
                        .controller("detailsCaterer", function ($scope, $http, $location, CatererService) {
                        var x = $location.absUrl().split("/")
                                var n = x.length
                                $scope.addDish = function (dish, index, button) {
                                var orderCaterer = JSON.parse(sessionStorage.getItem(x[n - 1])) == null ? [] : JSON.parse(sessionStorage.getItem(x[n - 1]))
                                        var data = []
                                        quantity = parseInt(document.querySelector(`#dish-${index}`).querySelector("input[name='product-qty']").value)
                                        if (orderCaterer.length != 0) {
                                currentDish = orderCaterer.find((item) => item.id == dish.id)
                                        if (currentDish && parseInt(currentDish.quantity) + quantity <= 999) {
                                currentDish.quantity = parseInt(currentDish.quantity) + quantity
                                        sessionStorage.setItem(x[n - 1], JSON.stringify(orderCaterer))
                                }
                                else if (currentDish) {
                                currentDish.quantity = quantity
                                        sessionStorage.setItem(x[n - 1], JSON.stringify(orderCaterer))

                                }
                                else {
                                dish.quantity = quantity
                                        orderCaterer.push(dish)
                                        sessionStorage.setItem(x[n - 1], JSON.stringify(orderCaterer))
                                }
                                }
                                else {
                                dish.quantity = quantity
                                        sessionStorage.setItem(x[n - 1], JSON.stringify([dish]))
                                }
                                }
                        // CatererService.getCatererDish()
                        //     .then(function (res) {
                        //         $scope.listDish = res.data

                        //     })
                        $scope.listDish = [
                        {
                        "image": "https://storage.googleapis.com/java-web-project-2d8bc.appspot.com/dish/antipastoplatter.jpg?GoogleAccessId=firebase-adminsdk-6buwh@java-web-project-2d8bc.iam.gserviceaccount.com&Expires=1717506226&Signature=ALUSBQNsFUeUuI%2F9VxYqN8DsqYxCis2n%2F5YpS9cgEmDmoLe9R1NIAmEvP%2FVvPigDhAathQLydnrmlpVcVCljSuAL%2FGjJE8YXC5Hesn23LLB6E299JlUSWIzlYW3JUBzrR2XN2R8aZITAe70wYUdz%2FsebyGcaniv8bf3WWElstvUrGaolK6RktBBDC%2FTYLAwqOeq08QreEP6Le%2FkMPTSh%2BNOSlO%2F8eCpZan2tQeSqx1QZcH%2FmsE%2FOzqZKlWOU3txHFC2EGfS6Y3bmrU0E5gWVUQESR0T4rJjrgvMdMMDuSiyCAvebQuhdIngemrgeVgonI%2BMjFSwu71Mpud4nIZ6MTQ%3D%3D",
                                "des": "An assortment of cured meats, cheeses, olives, and...",
                                "price": 180,
                                "name": "Antipasto Platter",
                                "tooltip": "An assortment of cured meats, cheeses, olives, and marinated vegetables.",
                                "id": 45
                        },
                        {
                        "image": "https://storage.googleapis.com/java-web-project-2d8bc.appspot.com/dish/bruschetta.jpg?GoogleAccessId=firebase-adminsdk-6buwh@java-web-project-2d8bc.iam.gserviceaccount.com&Expires=1717506226&Signature=I6l50UdVpMG1DXQa6y4Gmjk31RxD5vK4fFoOd0sWa%2FK8fpTUB0s5gaR%2FSSP4eFtiiiJx6YntetdiqQk2%2Fez4QeWFVi3JTLAMf%2B%2F5aNEqk9TzEYoUkqPD8ezTkUseqVqs9Kr3HNUJy2VY4DZNqZBByS1sLhS6nCH8WSDugIk27YYyaenB9UHPgKX9NxGqkqIF1TgRgfIStBezggBL5MYEsbzoXt8TctATLMSGjZky1AEKNWaiZyrpBr7XPyXPLNiT9WLRNXQ5VqjZ6yghILCYJ5BdVDTTTsSdKRt5wgzsh40tz1iNCa%2BfasvKo8FlP4Ku11sclChATFbju2W4790Ttg%3D%3D",
                                "des": "Toasted bread topped with fresh tomatoes, basil, a...",
                                "price": 60,
                                "name": "Bruschetta",
                                "tooltip": "Toasted bread topped with fresh tomatoes, basil, and garlic.",
                                "id": 46
                        },
                        {
                        "image": "https://storage.googleapis.com/java-web-project-2d8bc.appspot.com/dish/caprese%20salad.jpg?GoogleAccessId=firebase-adminsdk-6buwh@java-web-project-2d8bc.iam.gserviceaccount.com&Expires=1717506227&Signature=dT3Vx54psb7Slhh5StOXsJppfO0DXGFOiKLbo8mwf2dNO1ywduzCWMFtTu3eVeTionIVfbyqq8Aa5eqemjoFy6yMmQwMMyouXnj2vU%2BQzsUb%2FkQZ4tjdNL6hUA1fnGNxVEcgX8o5LLAXHm%2B2M0Tb7%2BCOGQY4yu1NTAuIswqzzW3B591c5OCCDr7NiiVaMcbvFCEJXCaiYEJNuN09l4onD9fzVAKFiFe6avuv3T%2FCJ3hMOC3gDDDnl%2FsgB2P6oHDHj7%2BniokPia70Za%2BFakk397V1vqWtePwAZkZ8KdNbFUesSxFZGvUZm4qrrIUZqUPtgWAFhm7jYg6JOB0j8WQ2Pw%3D%3D",
                                "des": "A classic salad with mozzarella, tomatoes, and bas...",
                                "price": 50,
                                "name": "Caprese Salad",
                                "tooltip": "A classic salad with mozzarella, tomatoes, and basil.",
                                "id": 47
                        },
                        {
                        "image": "https://storage.googleapis.com/java-web-project-2d8bc.appspot.com/dish/pastaprimavera.jpg?GoogleAccessId=firebase-adminsdk-6buwh@java-web-project-2d8bc.iam.gserviceaccount.com&Expires=1717506227&Signature=mVxYqOyL%2BCpCyrLBLLExB8BwFltP8JnWh3eEAEoqiV3lmZlxnXlJ3wfL3K7%2FvJiGRJzzaySw9%2BdzR%2Fg0MUGjXppOkFRBCvN%2BB1SpH%2BXD%2FMOKt92MDVzjSm7YGMK1gO9MgTwGeA2fnwJzMZLsxBdfvNjd33IUCa1YohZSzHwPIgcQ1YHZh5kLg8RaBkorOG6%2BuyFwoAqCHFMXW7A%2F325L8TB9McDRw4Gr2vHdLRASkxyWS%2B%2FKDpmTXQcy7%2BLRTP%2BVVrtBNN9mL28i8iGfiCJ1OVhsZto4mSTxzIxwXHgnqYhhRWk2pG57fY0WTr1erCJPckJRaEuXKGNCjEOIDkJGWA%3D%3D",
                                "des": "Pasta with a medley of fresh vegetables.",
                                "price": 120,
                                "name": "Pasta Primavera",
                                "tooltip": "Pasta with a medley of fresh vegetables.",
                                "id": 48
                        },
                        {
                        "image": "https://storage.googleapis.com/java-web-project-2d8bc.appspot.com/dish/lasagna.jpg?GoogleAccessId=firebase-adminsdk-6buwh@java-web-project-2d8bc.iam.gserviceaccount.com&Expires=1717506228&Signature=nFfdyIpSKzV1PpPaluOn5aCbLygcHXdfErdO48gmFuoJHqFM18782IUuQhK7q4Bxo65qFhSgY87ac0lq7MlvYd0Q9ls9O4sUI1Ti5zaromMsZoFTQjaF9Oqec7YX8kwGxlBwyxKMdeZ6N%2Fi38a41rKn1IJzKi3ZtDPovRHlfC4tqIFYhFwWXa0oUtiWOPZsUkt%2FpydU6ZLgFnSq9rrs1vKhbtpFBD3fpPTdCnld9iR5A78Bh%2BVniez1HIrBPLDLJzxSuLNzDe7RpavMcYnUuyTB1h8WnLtH9YuCe41CQgII4ZPdNPir8QENiGV3VKmig1aHqeIgTkid%2B7kyqaeHwSg%3D%3D",
                                "des": "Layers of pasta, meat sauce, cheese, and b?chamel ...",
                                "price": 140,
                                "name": "Lasagna",
                                "tooltip": "Layers of pasta, meat sauce, cheese, and b?chamel sauce.",
                                "id": 49
                        },
                        {
                        "image": "https://storage.googleapis.com/java-web-project-2d8bc.appspot.com/dish/tiramisu.jpg?GoogleAccessId=firebase-adminsdk-6buwh@java-web-project-2d8bc.iam.gserviceaccount.com&Expires=1717506228&Signature=TnorKFl1ER1yEuju6lZT2q5R6NrkmuBhMnMB6Ut9xe%2BkF4k5oTaxFdRE4zCQhvQRCoN524QG%2BbJYl1kqmh0vjJFz9hSirBnkKF6LVNuzkOqvQ7GrIcHaDuOhsHwFZ4%2F7exzKREzNMo9TIk9PwmxVbMs5p1knVX4XIPKiesbNgeT5fDpU6mVN6RI7XZ0JHg1yCTyBvuAlna8Z7wAXXdLAlXYyPnU6EByzavd6JfVOZ2QHJ3ZTx8k%2FREO4SKa%2FuWcroZyucJWVuZrrLL7mBz6UK80uyYPEsJO7SmMWL9bCLAzjd%2Bs4nP3DOHEdo5Lk5qnc%2FwIkWuMYdMUt6VjViq7DKQ%3D%3D",
                                "des": "Coffee-flavored dessert with layers of ladyfingers...",
                                "price": 70,
                                "name": "Tiramisu",
                                "tooltip": "Coffee-flavored dessert with layers of ladyfingers, mascarpone cream, and cocoa powder.",
                                "id": 50
                        },
                        {
                        "image": "https://storage.googleapis.com/java-web-project-2d8bc.appspot.com/dish/gelato.jpg?GoogleAccessId=firebase-adminsdk-6buwh@java-web-project-2d8bc.iam.gserviceaccount.com&Expires=1717506228&Signature=oAtTboZmqa6XBtJs3ndwNdB55yeIv%2F98LkKBR3Rih59veb17Ms%2F%2F04PsFfTBwESNr11Xt3OeGQHVsXtklJnRjNLDtWQTYOGdROYkWMB2MKZ57xl7O5QMZy6UrOraKjNxczCXDD2JHRkWx0SwRtfEPBGy8Q7O5DY1VsTaqqGnZdGKssq7IraGyTYxoJoV9c09Bkb2FHKW%2FAT%2FAiKBoXCoOps0MD0OXuxZoD%2FiXCjMQop1pUXk6K9Hgk%2FuOorrd8yhYtlYiW7fizhUbqdB%2FSXaq2Zt8StrPubEprkrpR7XFgjkS4P%2FfqUPGWWAdIleYimjXYKM3pNPtlghzgyYX4K%2Fbw%3D%3D",
                                "des": "Italian ice cream with a dense and creamy texture.",
                                "price": 40,
                                "name": "Gelato",
                                "tooltip": "Italian ice cream with a dense and creamy texture.",
                                "id": 51
                        }
                        ]
                        })
                        .controller("order", function ($scope, $http, $location, $window, CatererService) {
                        var x = $location.absUrl().split("/")
                                var n = x.length
                                // CatererService.getCatererVoucher()
                                //     .then(function (res) {
                                //         $scope.listVoucher = res.data

                                //     })
                                $scope.listVoucher = [
                                {
                                "maxValue": 15,
                                        "ID": 3,
                                        "type": 2,
                                        "value": 15
                                }
                                ]
                                $scope.displayVoucher = function (type, value, maxValue) {
                                if (type == 1) {
                                return `Discount ${value}% (Max: ${maxValue})`
                                }
                                else {
                                return `Voucher $${value}`
                                }
                                }
                        $scope.postOrder = function () {
                        $http.post("/orders/makeNewOrder", {
                        data: $scope.order,
                                fullNameEmail: x[n - 1]
                        })
                                .then(function (response) {
                                })
                                .catch(function (error) {
                                });
                        }
                        $scope.updateValueDishOrder = function (dish, index, button, operation) {

                        updateValue(button.currentTarget, operation)
                                quantity = parseInt(document.querySelector(`#order-${index}`).querySelector("input[name='product-qty']").value)

                                data = JSON.parse(sessionStorage.getItem(x[n - 1]))
                                data.find((item) => item.id == dish.id).quantity = quantity
                                sessionStorage.setItem(x[n - 1], JSON.stringify(data))
                                if (quantity == 0) {
                        $scope.deleteDish(dish)
                        }

                        }
                        $scope.deleteDish = function (dish) {
                        data = JSON.parse(sessionStorage.getItem(x[n - 1]))
                                data = data.filter((item) => item.id != dish.id)
                                sessionStorage.setItem(x[n - 1], JSON.stringify(data))
                        }
                        $scope.render = function () {
                        $scope.order = JSON.parse(sessionStorage.getItem(x[n - 1])) == null ? [] : JSON.parse(sessionStorage.getItem(x[n - 1]))
                                $scope.totalValue = $scope.calcTotalValue()

                                $scope.totalValue = $scope.totalValue
                                $scope.isEmpty = $scope.order.length == 0 ? true : false
                        };
                        $scope.calcTotalValue = function () {
                        var total = $scope.order !== null ? $scope.order.reduce((sum, item) => sum += item.quantity * item.price, 0) : 0

                                return total
                        }

                        // Khởi tạo controller
                        $scope.render();
                        $scope.$watch(
                                function () {
                                return $window.sessionStorage.getItem(x[n - 1]);
                                },
                                function (newVal, oldVal) {
                                if (newVal !== oldVal) {
                                $scope.render();
                                }
                                }
                        );
                        $scope.calcTotal = function (price, quantity) {
                        return price * quantity
                        }
                        })
                        function getVoucher() {
                        return document.querySelector("#selectedVoucher").innerText.trim("\n") == "" ? 0 : $scope.listVoucher.find((item) => item.id === $scope.selectedVoucher)
                        }
                function toggleModalOrder() {
                if (document.querySelector("#modalOrder").classList.contains("d-none")) {
                document.querySelector("#modalOrder").classList.remove("d-none")
                }
                else {
                document.querySelector("#modalOrder").classList.add("d-none")
                }
                }
                function updateValue(button, operation) {
                // Get the input element
                const input = button.parentElement.querySelector('input[name="product-qty"]');
                // Parse the current value of the input
                let value = parseInt(input.value);
                // Update the value based on the operation
                if (operation === 'minus' && value > parseInt(input.min)) {
                value -= 1;
                } else if (operation === 'add' && value < parseInt(input.max)) {
                value += 1;
                }
                // Set the new value back to the input
                input.value = value;
                }
            </script>-->
            <script th:src="@{/js/jquery.min.js}"></script>
            <script>
                $(document).ready(function () {
                    displayOrderedDishes();
                    $('#districtID').prop('selectedIndex', 0);
                });
                
                function changeAddress() {
                    if ($('#address-type').val() === 0) {
                        $('#address-type-0').css({
                           display: 'block' 
                        });
                        $('#address-type-1').css({
                           display: 'none' 
                        });
                    }
                    else {
                        $('#address-type-0').css({
                           display: 'none' 
                        });
                        $('#address-type-1').css({
                           display: 'block' 
                        });
                    }
                }
                
                function addDish(event, form) {
                    event.preventDefault();
                    $(document).ready(function () {
                        data = new FormData(form);
                        id = data.get('id');
                        quantity = 0;
                        if (data.get('quantity') !== '') {
                            quantity = data.get('quantity');
                        }
                        form.reset();
                        $.ajax({
                            url: '/addDish',
                            type: 'POST',
                            data: {
                                id: id,
                                quantity: quantity
                            },
                            success: function () {
                                displayOrderedDishes();
                            }
                        });
                    });
                }

                function writeOrderedDishTag(dish) {
                    id = dish.id;
                    name = dish.name;
                    img = dish.img;
                    price = dish.price;
                    quantity = dish.quantity;
                    result = `<div>
                                <img src="` + img + `"/>
                                <div>` + name + `</div>
                                <div>` + (price * quantity) + `</div>
                                <form onsubmit="addDish(event, this)">
                                    <input type="hidden" name="id" value="` + id + `">
                                    <input type="hidden" name="quantity" value="-1">
                                    <button type="submit">-</button>
                                </form>
                                <div>` + quantity + `</div>
                                <form onsubmit="addDish(event, this)">
                                    <input type="hidden" name="id" value="` + id + `">
                                    <input type="hidden" name="quantity" value="1">
                                    <button type="submit">+</button>
                                </form>
                            </div>`;
                    return result;
                }

                function displayOrderedDishes() {
                    $(document).ready(function () {
                        $.ajax({
                            url: '/getOrderListFE',
                            type: 'POST',
                            success: function (response) {
                                newHtml = '';
                                for (let index = 0; index < response.length; index++) {
                                    if (response[index].quantity > 0) {
                                        newHtml += writeOrderedDishTag(response[index]);
                                    }
                                }
                                $('#orderDishes').html(newHtml);
                                calcTotal();
                            }
                        });
                    });
                }
                
                function calcTotal() {
                    $(document).ready(function() {
                       $.ajax({
                          url: '/calcTotal',
                          type: 'GET',
                          data: {
                              voucherID: $('#selectedVoucher').val(),
                              usePoint: $('#usePoint').val()
                          },
                          success: function (response) {
                              $('#total').text('$' + response);
                          }
                       });
                    });
                }
                
                function createOrder() {
                    $(document).ready(function () {
                        $('#orderTime-error').text('');
                        $('#address-0-error').text('');
                        $('#error').text('');
                        voucherID = $('#selectedVoucher').val();
                        usePoint = $('#usePoint').val();
                        orderTime = $('#orderTime').val();
                        addressType = $('#address-type').val();
                        address0 = $('#address-0').val();
                        districtID = $('#districtID').val();
                        address1 = 0;
                        note = $('#note').val();
                        if (addressType == 1) {
                            address1 = $('#address-1').val();
                        }
                        valid = true;
                        regex = /^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]) (2[0-3]|[01][0-9]):[0-5][0-9]$/;
                        if (!regex.test(orderTime)) {
                            valid = false;
                            $('#orderTime-error').text('Please enter valid time');
                        }
                        if (addressType == 0 && address0.trim().length === 0) {
                            valid = false;
                            $('#address-0-error').text('Please enter address');
                        }
                        if (!valid) {
                            return;
                        }
                        $.ajax({
                            url: '/createOrder',
                            type: 'POST',
                            data: {
                                voucherID: voucherID,
                                usePoint: usePoint,
                                orderTime: orderTime,
                                addressType: addressType,
                                address0: address0,
                                districtID: districtID,
                                address1: address1,
                                note: note
                            },
                            success: function (response) {
                                if (response.status === 'Fail') {
                                    $('#error').text('The request cannot be completed at the moment, please try again later');
                                }
                                else if (response.status === 'OK') {
                                    setTimeout(function () {
                                        $('#error').text('Created successfully');
                                        location.href = response.target;
                                    }, 3000);
                                }
                            }
                        });
                    });
                }
            </script>
            <script th:if="${addressList != null}">
                $(document).ready(function () {
                    $('#address-1').prop('selectedIndex', 0);
                });
            </script>
        </div>

    </body>

</html>